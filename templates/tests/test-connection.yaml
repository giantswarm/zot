apiVersion: v1
kind: Secret
metadata:
  name: servercert
data:
  certificate: |-
    LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN6akNDQWJhZ0F3SUJBZ0lVR3pFR1pjY3VU
    Y2tDeU9KYzVSTExrZVpYZGJFd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0RERUtNQWdHQTFVRUF3d0JL
    akFlRncweU16QTNNVGN4TmpBNU1UZGFGdzB6TXpBM01UUXhOakE1TVRkYQpNQ0V4RXpBUkJnTlZC
    QXNNQ2xSbGMzUlRaWEoyWlhJeENqQUlCZ05WQkFNTUFTb3dnZ0VpTUEwR0NTcUdTSWIzCkRRRUJB
    UVVBQTRJQkR3QXdnZ0VLQW9JQkFRQ2dLVVlPMS9pemJTK1QvSTBOZE9xUENSM1AzWEY2YlFPdnYw
    YzYKU1FnVCtyU3B6K2tacnYrd2orQTlDYVUyTnVxZ1k1dEl5aHltWDZOLzVGWGw3RnMyOGhZdFZu
    ZXI0SXN1WDBPQwo3WUhINTMwdGd5a1VzM3BwYzZqSjlqQjNLOEVaN2tKaGUxdGxTRytsaUUwMFFs
    Yk5nbnJOR2JPS1ltaGxrTTBWClJtNzlTbytqNmVZUlZPZHhJNkFDdWplNTJiYXlFN2p3ZndyeEIx
    a1ZMWEFGQU12enFOWkRiNzNZSWM2bE1jOWoKcmcxOUFkQklFbjBkc1FxQ3V3VDhoYXdwbldNR0kv
    Mi9ySWduWTZHOEVqN1hsMnBYSlhvZmsxZTlHb25uQTZ0NwpnYWl5VmQ4ZUtYUjQxNnpIb3FGN1Z6
    RkZNcU4rSGs1VUlLeVJ2OVZ0T1dVOHdVNEZBZ01CQUFHakV6QVJNQThHCkExVWRFUVFJTUFhSEJI
    OEFBQUV3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUduZnJmbFFkTVpYNEEwc1VEK04KeHZQYVB3
    c0hZdG01WHNnOWlmQWIrYVV1ME4yTkpnQ3ZGdFBDV3k5a2J1SDJDNnFZYllZcndvUmlwVHBGQlo1
    QgpOR1UzQS9QNkhkbExwdEVWQi9kZmE5RjVnMDRNclNEblV2Sis0ZlpjY1VscjhVTVB0eGNhQUl0
    MVQxQVo0RHQ0CjRnamVROWxzVWw0ZVFyM20vRGxSRjk5RDRjNS9nT3dRL3BKVEF4MkhaL0o0Rjhl
    emF4TWRWMXhOQkNXZ1JJZ3cKQngrSXhIT2tORDhtNWNwZmxrLy9meGtjMktjc3dmdkNTY0UrUFpB
    YWpONW1uRFRTWjdIZXQ1Y1RNR2xyL1FCWAp5KzJkUkdkRGpGMVJNS2RJVEhTRHNhekxCNzZmWHl3
    OEZuT0hCTnZkMkFpNmxzTC9PS2pxRTFMU0JqdVFRdDhQCkRwZz0KLS0tLS1FTkQgQ0VSVElGSUNB
    VEUtLS0tLQo=
---
apiVersion: v1
kind: Secret
metadata:
  name: serverkey
data:
  key: |-
    LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZB
    QVNDQktnd2dnU2tBZ0VBQW9JQkFRQ2dLVVlPMS9pemJTK1QKL0kwTmRPcVBDUjNQM1hGNmJRT3Z2
    MGM2U1FnVCtyU3B6K2tacnYrd2orQTlDYVUyTnVxZ1k1dEl5aHltWDZOLwo1RlhsN0ZzMjhoWXRW
    bmVyNElzdVgwT0M3WUhINTMwdGd5a1VzM3BwYzZqSjlqQjNLOEVaN2tKaGUxdGxTRytsCmlFMDBR
    bGJOZ25yTkdiT0tZbWhsa00wVlJtNzlTbytqNmVZUlZPZHhJNkFDdWplNTJiYXlFN2p3ZndyeEIx
    a1YKTFhBRkFNdnpxTlpEYjczWUljNmxNYzlqcmcxOUFkQklFbjBkc1FxQ3V3VDhoYXdwbldNR0kv
    Mi9ySWduWTZHOApFajdYbDJwWEpYb2ZrMWU5R29ubkE2dDdnYWl5VmQ4ZUtYUjQxNnpIb3FGN1Z6
    RkZNcU4rSGs1VUlLeVJ2OVZ0Ck9XVTh3VTRGQWdNQkFBRUNnZ0VBUWcvRUxlczNVZ3IvVFBNbTJ4
    NFdnZGtveXN4ME9pTXRHaGl6c0g3ZkxoNkMKMW1oRHBheGhHdHE5aTIrbkRhMnBLVzdzWmlHM240
    aGpVQ1ZHcVFmTXQrVXk4SkJ4M0J0S1RWNU40bnRFeE1mZgpBaDdQbXhKTXM2SlpSTFNmV1FoYkpl
    NzR3bXkzVGhlS3RhUjY4OHRKTW90WFM3SUdORlpTNlZISXhiVy9vZ213CkdUQmlKejV1aHNhYkFT
    UVVySWNvUDVXUy93VmE0ejh2Z2wxb2UwdEMrdFpseHkrODh0b3ZVRm1SSU01ZHZNYmUKa2YwWXlE
    bzgrblQrejRob2FRbzdlTDVuMG1QWEVoVUdERkNDS0J0aGdaYjE5QzBGRUZLbGsvUFQrSGl1QUxR
    dQp0cnpjdHBHeUhuK3YyVTZqM2d4NnlGOUhLR1phWWRqV1MveEtQc3Y5SVFLQmdRRE1WaG9nMWZx
    ZjhLTEZWVTZVCis0ZTRiQjJCWU95YzlKQXlneHNTVXhoSzVMdVVCeFBLWnhobU1nMkdlS2VRT2py
    YldzNm9Jd3V0M3VpMjlNNEsKdDgyV0UvYXFidk54NFRqODBEdzJmTEFBaGtzOXJLNVVnRXJXdGRi
    a1AzSVk1L3hiN2ErZEFDU1AzWWFQSlIwUQpza3pnQjlRNUtzYWtSU282UStqb1hnQ29Md0tCZ1FE
    SXArTmNkTm03Y2NIRDg0SlBMQkF2d2dGQS9ORkxTQTVyCjRORlZ6eDN1eDU4a2FJMVBBMnJSUjh3
    bzJTWjVoTXhOM1FSa2t0TEZFa09PbkwrcGRpNVBFN2pNVEwrcUd3VHAKMmg4VTdQOGNrVFU3RGky
    N2hCc3R5ZEo0ZWlSQ1dUZFphclAraUQ3Mms3bExKaUhvL3U1UkYxY0szR2FvaUxXQQpKUGl5UU00
    c0N3S0JnUUNzMVZOS1hOT2RQd1BlbDdaZEM1Z1RwTmNjSE9obUpmSmwxMEVwc2NGRmI4MDlldk1C
    CmEweFcvSlUySFkzVnozc0RHUDdkZHE4bFJQdGY3UmJ1TitPYndvME1RY2FHbDNNRlcvamlPWHNC
    SnBZenQ0REoKRnE2Mmg1NFk5NVZCZmMrVnppaVJTcEtpWVVTMGhUYmRiWUxhcDZTWktoWlUwZS9T
    MHFnSkM2SFFud0tCZ0E5cgpOMEZuaVVPcUhpV2NsS3JZeS9XZmh0RWpuRUdZcStNR1I0KzhkcVJl
    bXBBRnFMWWxvUk9yM0xoVzEyb0hGbHYxClc5ME9tenVoaDZkeHpCaU5pRWx6VG9RRWNjWDBoWkFp
    dnJpdzdYbVlmdXFtMEVUVWhmSWl6QldON1ROYi83RFQKVGptRTVyR3o4RTBpQlFFT2RlbXRUWGI4
    TUxkS3FnZkt6NEdERVZTNUFvR0JBTDJOdHUyT0FlbS82Q0VadUZoegpsSzFnRXlYUzBjaXUxMmx1
    UVhib3JEd3p3enErYWJWL3IwdlQveGtZS1BDUzVQMFVMUWhzQUd6N0tpck10clZCCkQvM3F5aXV6
    UlU1cDg2SmlIa0c1Z1JHa2Y0TStsK0FMNjhaSytoY2FqWEJyN1VjM2ZKb3dpK3Z6NGlwaThERDYK
    QVpHc2dMWlhjUWVjMkJJYWUrTHphalV6Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
---
apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "zot.fullname" . }}-test-connection"
  labels:
    {{- include "zot.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: alpine:3.18
      command:
      - sh
      - -c
      - |
        scheme="http"
        {{- if eq $.Values.httpGet.scheme "HTTPS"}}
          scheme="https"
        {{- end }}
        echo "$scheme"
        {{- if .Values.authHeader }}
          wget --no-check-certificate --header "Authorization: Basic {{ .Values.authHeader }}" $scheme://{{ include "zot.fullname" . }}:{{ .Values.service.port }}/v2/_catalog
        {{- else }}
          wget --no-check-certificate $scheme://{{ include "zot.fullname" . }}:{{ .Values.service.port }}/v2/_catalog
        {{- end }}
  restartPolicy: Never
